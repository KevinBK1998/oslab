PUSH BP
MOV BP,SP
JMP MAIN

COMPARE_FUN:MOV R2,R1
MOV R1, 6
CALL GET_ARGS
EQ R0,R2
RET

GET_ARGS:MOV R0, BP
SUB R0, R1
MOV R0, [R0]
RET

GET_HB_SIZE:MOV R0, 2048
MOV R1, 4
RET

MAIN:MOV R1, "Heapset"
CALL COMPARE_FUN
JZ R0, ALLOC_CHECK
CALL GET_HB_SIZE
SUB R0, R1
MOV R2, R0
HEAP_LOOP:SUB R2, R1
MOV [R0],R2
SUB R0, R1
MOV R3, 1024
EQ R3, R0
JZ R3, HEAP_LOOP
MOV [R0],-1
MOV R0,0
JMP END

ALLOC_CHECK:MOV R1, "Alloc"
CALL COMPARE_FUN
JZ R0, FREE_CHECK
CALL GET_HB_SIZE
SUB R0, R1
MOV R1, [R0]
MOV R2, [R1]
MOV [R0], R2
MOV R0, R1
JMP END

FREE_CHECK:MOV R1, "Free"
CALL COMPARE_FUN
JZ R0, WRITE_CHECK
MOV R1, 5
CALL GET_ARGS
MOV R2, R0
CALL GET_HB_SIZE
SUB R0, R1
MOV [R2], [R0]
MOV [R0], R2
MOV R0, 0
JMP END

WRITE_CHECK:MOV R1, "Write"
CALL COMPARE_FUN
JZ R0, READ_CHECK
MOV R0, 5
JMP PUSH_ARGS

READ_CHECK:MOV R1, "Read"
CALL COMPARE_FUN
JZ R0, FORK_CHECK
MOV R0, 7
JMP PUSH_ARGS

FORK_CHECK:MOV R1, "Fork"
CALL COMPARE_FUN
JZ R0, EXEC_CHECK
MOV R0, 8
JMP PUSH_ARGS

EXEC_CHECK:MOV R1, "Exec"
CALL COMPARE_FUN
JZ R0, EXIT_CHECK
MOV R0, 9
JMP PUSH_ARGS

EXIT_CHECK:MOV R1, "Exit"
CALL COMPARE_FUN
JZ R0, GETPID_CHECK
MOV R0, 10
JMP PUSH_ARGS

GETPID_CHECK:MOV R1, "Getpid"
CALL COMPARE_FUN
JZ R0, GETPPID_CHECK
MOV R0, 11
JMP PUSH_ARGS

GETPPID_CHECK:MOV R1, "Getppid"
CALL COMPARE_FUN
JZ R0, WAIT_CHECK
MOV R0, 12
JMP PUSH_ARGS

WAIT_CHECK:MOV R1, "Wait"
CALL COMPARE_FUN
JZ R0, SIGNAL_CHECK
MOV R0, 13
JMP PUSH_ARGS

SIGNAL_CHECK:MOV R1, "Signal"
CALL COMPARE_FUN
JZ R0, SEMGET_CHECK
MOV R0, 14
JMP PUSH_ARGS

SEMGET_CHECK:MOV R1, "Semget"
CALL COMPARE_FUN
JZ R0, SEMRELEASE_CHECK
MOV R0, 17
JMP PUSH_ARGS

SEMRELEASE_CHECK:MOV R1, "Semrelease"
CALL COMPARE_FUN
JZ R0, SEMLOCK_CHECK
MOV R0, 18
JMP PUSH_ARGS

SEMLOCK_CHECK:MOV R1, "SemLock"
CALL COMPARE_FUN
JZ R0, SEMUNLOCK_CHECK
MOV R0, 19
JMP PUSH_ARGS

SEMUNLOCK_CHECK:MOV R1, "SemUnLock"
CALL COMPARE_FUN
JZ R0, SHUTDOWN_CHECK
MOV R0, 20
JMP PUSH_ARGS

SHUTDOWN_CHECK:MOV R1, "Shutdown"
CALL COMPARE_FUN
JZ R0, END
MOV R0, 21
BRKP
JMP PUSH_ARGS

PUSH_ARGS:PUSH R0
MOV R1, 5
CALL GET_ARGS
PUSH R0
MOV R1, 4
CALL GET_ARGS
PUSH R0
MOV R1, 3
CALL GET_ARGS
PUSH R0
PUSH R0
MOV R1, "Write"
CALL COMPARE_FUN
JZ R0, READ_CALL_CHECK
INT 7
JMP POP_ARGS

READ_CALL_CHECK:MOV R1, "Read"
CALL COMPARE_FUN
JZ R0, FORK_CALL_CHECK
INT 6
JMP POP_ARGS

FORK_CALL_CHECK:MOV R1, "Fork"
CALL COMPARE_FUN
JZ R0, EXEC_CALL_CHECK
INT 8
JMP POP_ARGS

EXEC_CALL_CHECK:MOV R1, "Exec"
CALL COMPARE_FUN
JZ R0, EXIT_CALL_CHECK
INT 9
JMP POP_ARGS

EXIT_CALL_CHECK:MOV R1, "Exit"
CALL COMPARE_FUN
JZ R0, GETPID_CALL_CHECK
INT 10
JMP POP_ARGS

GETPID_CALL_CHECK:MOV R1, "Getpid"
CALL COMPARE_FUN
JZ R0, GETPPID_CALL_CHECK
INT 11
JMP POP_ARGS

GETPPID_CALL_CHECK:MOV R1, "Getppid"
CALL COMPARE_FUN
JZ R0, WAIT_CALL_CHECK
INT 11
JMP POP_ARGS

WAIT_CALL_CHECK:MOV R1, "Wait"
CALL COMPARE_FUN
JZ R0, SIGNAL_CALL_CHECK
INT 11
JMP POP_ARGS

SIGNAL_CALL_CHECK:MOV R1, "Signal"
CALL COMPARE_FUN
JZ R0, SEMGET_CALL_CHECK
INT 11
JMP POP_ARGS

SEMGET_CALL_CHECK:MOV R1, "Semget"
CALL COMPARE_FUN
JZ R0, SEMRELEASE_CALL_CHECK
INT 13
JMP POP_ARGS

SEMRELEASE_CALL_CHECK:MOV R1, "Semrelease"
CALL COMPARE_FUN
JZ R0, SEMLOCK_CALL_CHECK
INT 13
JMP POP_ARGS

SEMLOCK_CALL_CHECK:MOV R1, "SemLock"
CALL COMPARE_FUN
JZ R0, SEMUNLOCK_CALL_CHECK
INT 14
JMP POP_ARGS

SEMUNLOCK_CALL_CHECK:MOV R1, "SemUnLock"
CALL COMPARE_FUN
JZ R0, SHUTDOWN_CALL_CHECK
INT 14
JMP POP_ARGS

SHUTDOWN_CALL_CHECK:MOV R1, "Shutdown"
CALL COMPARE_FUN
JZ R0, END
INT 15
JMP POP_ARGS

POP_ARGS:POP R1
POP R0
POP R0
POP R0
POP R0
MOV R0, R1
JMP END

END:
MOV R2,R0
MOV R0, BP
MOV R1, 2
SUB R0,R1
MOV [R0], R2
MOV BP, [SP]
POP R0
RET
